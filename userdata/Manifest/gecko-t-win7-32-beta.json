{
  "Components": [
    {
      "ComponentName": "KillXenDPriv.exe",
      "ComponentType": "CommandRun",
      "Comment": "See https://bugzilla.mozilla.org/show_bug.cgi?id=1399401#c43 and https://bugzilla.mozilla.org/show_bug.cgi?id=1394757",
      "Command": "taskkill",
      "Arguments": [
        "/im",
        "XenDPriv.exe",
        "/f"
      ],
      "Validate": {
        "PathsNotExist": [
          "C:\\Program Files\\Citrix\\XenTools\\XenDPriv.exe"
        ]
      }
    },
    {
      "ComponentName": "DeleteXenDPriv.exe",
      "ComponentType": "CommandRun",
      "Comment": "See https://bugzilla.mozilla.org/show_bug.cgi?id=1399401#c43 and https://bugzilla.mozilla.org/show_bug.cgi?id=1394757",
      "Command": "cmd.exe",
      "Arguments": [
        "/c",
        "del",
        "/f",
        "/q",
        "\"C:\\Program Files\\Citrix\\XenTools\\XenDPriv.exe\""
      ],
      "Validate": {
        "PathsNotExist": [
          "C:\\Program Files\\Citrix\\XenTools\\XenDPriv.exe"
        ]
      },
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "KillXenDPriv.exe"
        }
      ]
    },
    {
      "ComponentName": "LogDirectory",
      "ComponentType": "DirectoryCreate",
      "Comment": "Required by OpenCloudConfig for DSC logging",
      "Path": "C:\\log"
    },
    {
      "ComponentName": "NxLog",
      "ComponentType": "MsiInstall",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Url": "https://nxlog.co/system/files/products/files/348/nxlog-ce-2.9.1716.msi",
      "Name": "NxLog-CE",
      "ProductId": "FC526514-AFD9-4A5C-8677-56241539609D",
      "sha512": "70f5516bca0ff7814833ef397c01dbcd1c7011c0ef4b0f2aeda2e1aa7c02fe680eddfd1c0656f8d438559e34e5a841360dc6dafa7843c610528df2e1defb02be"
    },
    {
      "ComponentName": "PaperTrailEncryptionCertificate",
      "ComponentType": "ChecksumFileDownload",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Source": "https://papertrailapp.com/tools/papertrail-bundle.pem",
      "Target": "C:\\Program Files\\nxlog\\cert\\papertrail-bundle.pem",
      "DependsOn": [
        {
          "ComponentType": "MsiInstall",
          "ComponentName": "NxLog"
        }
      ]
    },
    {
      "ComponentName": "NxLogPaperTrailConfiguration",
      "ComponentType": "ChecksumFileDownload",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/nxlog/win7.conf",
      "Target": "C:\\Program Files\\nxlog\\conf\\nxlog.conf",
      "DependsOn": [
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "PaperTrailEncryptionCertificate"
        }
      ]
    },
    {
      "ComponentName": "Start_nxlog",
      "ComponentType": "ServiceControl",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Name": "nxlog",
      "StartupType": "Automatic",
      "State": "Running",
      "DependsOn": [
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "NxLogPaperTrailConfiguration"
        }
      ]
    },
    {
      "ComponentName": "ProcessExplorer",
      "ComponentType": "ZipInstall",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Url": "https://download.sysinternals.com/files/ProcessExplorer.zip",
      "Destination": "C:\\ProcessExplorer",
      "sha512": "ef89598b2d7f4659a98b0ace28f5b5274a93203d2a2296e37eadedf8cb0337ee5ccc161377644dae1c3e8526fc2545190077635e07458f7e4e74c5b3241f5e30"
    },
    {
      "ComponentName": "ProcessMonitor",
      "ComponentType": "ZipInstall",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Url": "https://s3.amazonaws.com/windows-opencloudconfig-packages/ProcessMonitor/ProcessMonitor.zip",
      "Destination": "C:\\ProcessMonitor",
      "sha512": "3db4ad44652c2dbf7bdd03c88339cbd19d672f6363e3a3b6a5a45adbd62c6b4131e491d2fa8f31fb2a60c7555e202c25bc8088d9bdf0896dcb7e3366782e204f"
    },
    {
      "ComponentName": "GpgForWin",
      "ComponentType": "ExeInstall",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Url": "http://files.gpg4win.org/gpg4win-2.3.0.exe",
      "Arguments": [
        "/S"
      ],
      "Validate": {
        "PathsExist": [
          "C:\\Program Files\\GNU\\GnuPG\\pub\\gpg.exe",
          "C:\\Program Files\\GNU\\GnuPG\\pub\\gpg2.exe"
        ]
      },
      "sha512": "b1c48d84d041055db3d3e3cbd22ef2f3300728b06c76660b9b78ececf56b7ccbc80addb39a64c0a4eb68bf3463ceb6d254dedda047049ce680e9d543dd8a9af9"
    },
    {
      "ComponentName": "SevenZip",
      "ComponentType": "ExeInstall",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Url": "http://7-zip.org/a/7z1602.exe",
      "Arguments": [
        "/S"
      ],
      "Validate": {
        "PathsExist": [
          "C:\\Program Files\\7-Zip\\7z.exe",
          "C:\\Program Files\\7-Zip\\7z.dll"
        ]
      },
      "sha512": "ad8298ae7d170c9a3e7f66a6098dd017adcd7912ba3938237db88dca141b6606b095a1c7c7fff0a2d4b47405ffbd25d65e5d8d98a55a8abaf3ced12854c18c4c"
    },
    {
      "ComponentName": "SublimeText3",
      "ComponentType": "ExeInstall",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Url": "https://download.sublimetext.com/Sublime%20Text%20Build%203114%20Setup.exe",
      "Arguments": [
        "/VERYSILENT",
        "/NORESTART",
        "/TASKS=\"contextentry\""
      ],
      "Validate": {
        "PathsExist": [
          "C:\\Program Files\\Sublime Text 3\\subl.exe",
          "C:\\Program Files\\Sublime Text 3\\sublime_text.exe"
        ]
      },
      "sha512": "99bb189e112a67358095554711c208fb9ec1bd35d3a333c0f4a157f1715bd0b852140231ab41fc161c262531340f954ccb8bfe792a35849f73596aa757ef3249"
    },
    {
      "ComponentName": "SublimeText3_PackagesFolder",
      "ComponentType": "DirectoryCreate",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Path": "C:\\Users\\Administrator\\AppData\\Roaming\\Sublime Text 3\\Packages"
    },
    {
      "ComponentName": "SublimeText3_PackageControl",
      "ComponentType": "FileDownload",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Source": "http://sublime.wbond.net/Package%20Control.sublime-package",
      "Target": "C:\\Users\\Administrator\\AppData\\Roaming\\Sublime Text 3\\Packages\\Package Control.sublime-package",
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "SublimeText3"
        },
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "SublimeText3_PackagesFolder"
        }
      ]
    },
    {
      "ComponentName": "SystemPowerShellProfile",
      "ComponentType": "FileDownload",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/Microsoft.PowerShell_profile.ps1",
      "Target": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\Microsoft.PowerShell_profile.ps1"
    },
    {
      "ComponentName": "FsutilDisable8Dot3",
      "ComponentType": "CommandRun",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Command": "fsutil.exe",
      "Arguments": [
        "behavior",
        "set",
        "disable8dot3",
        "1"
      ],
      "Validate": {
        "CommandsReturn": [
          {
            "Command": "fsutil.exe",
            "Arguments": [
              "behavior",
              "query",
              "disable8dot3"
            ],
            "Match": "The registry state is: 1 (Disable 8dot3 name creation on all volumes)."
          }
        ]
      }
    },
    {
      "ComponentName": "FsutilDisableLastAccess",
      "ComponentType": "CommandRun",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Command": "fsutil.exe",
      "Arguments": [
        "behavior",
        "set",
        "disablelastaccess",
        "1"
      ],
      "Validate": {
        "CommandsReturn": [
          {
            "Command": "fsutil.exe",
            "Arguments": [
              "behavior",
              "query",
              "disablelastaccess"
            ],
            "Match": "DisableLastAccess = 1"
          }
        ]
      }
    },
    {
      "ComponentName": "home",
      "ComponentType": "SymbolicLink",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Target": "C:\\Users",
      "Link": "C:\\home"
    },
    {
      "ComponentName": "MozillaBuildSetup",
      "ComponentType": "ExeInstall",
      "Comment": "Base Firefox on Windows build requirement",
      "Arguments": [
        "/S",
        "/D=C:\\mozilla-build"
      ],
      "Url": "http://ftp.mozilla.org/pub/mozilla/libraries/win32/MozillaBuildSetup-2.2.0.exe",
      "Validate": {
        "PathsExist": [
          "C:\\mozilla-build\\info-zip\\unzip.exe",
          "C:\\mozilla-build\\info-zip\\zip.exe",
          "C:\\mozilla-build\\msys\\bin\\sh.exe",
          "C:\\mozilla-build\\msys\\local\\bin\\make.exe",
          "C:\\mozilla-build\\msys\\local\\bin\\autoconf-2.13",
          "C:\\mozilla-build\\python\\python.exe",
          "C:\\mozilla-build\\upx391w\\upx.exe",
          "C:\\mozilla-build\\yasm\\yasm.exe"
        ],
        "FilesContain": [
          {
            "Path": "C:\\mozilla-build\\VERSION",
            "Match": "2.2.0"
          }
        ]
      },
      "sha512": "b593aa4ed9ff34bd4a20860fec478b3638ff1f916a60dc79ebcff46cee279fdb59dd53a36579378f0e11f4be201114578a429bfbfc11eda195a0b1db7aa9831e"
    },
    {
      "ComponentName": "msys_home",
      "ComponentType": "SymbolicLink",
      "Comment": "Maintenance Toolchain - not essential for building firefox",
      "Target": "C:\\Users",
      "Link": "C:\\mozilla-build\\msys\\home",
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "MozillaBuildSetup"
        }
      ]
    },
    {
      "ComponentName": "reg_PythonInstallPath",
      "ComponentType": "RegistryValueSet",
      "Comment": "",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Python\\PythonCore\\2.7\\InstallPath",
      "ValueName": "(Default)",
      "ValueType": "String",
      "ValueData": "C:\\mozilla-build\\python",
      "Hex": false,
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "MozillaBuildSetup"
        }
      ]
    },
    {
      "ComponentName": "reg_PythonPath",
      "ComponentType": "RegistryValueSet",
      "Comment": "",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Python\\PythonCore\\2.7\\PythonPath",
      "ValueName": "(Default)",
      "ValueType": "String",
      "ValueData": "C:\\mozilla-build\\python\\Lib;C:\\mozilla-build\\python\\DLLs;C:\\mozilla-build\\python\\Lib\\lib-tk",
      "Hex": false,
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "MozillaBuildSetup"
        }
      ]
    },
    {
      "ComponentName": "DeleteMozillaBuildMercurial",
      "ComponentType": "CommandRun",
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "MozillaBuildSetup"
        }
      ],
      "Command": "cmd.exe",
      "Arguments": [
        "/c",
        "del",
        "C:\\mozilla-build\\python\\Scripts\\hg*"
      ],
      "Validate": {
        "PathsNotExist": [
          "C:\\mozilla-build\\python\\hg",
          "C:\\mozilla-build\\python\\hg.exe"
        ]
      }
    },
    {
      "ComponentName": "Mercurial",
      "ComponentType": "MsiInstall",
      "Comment": "https://bugzilla.mozilla.org/show_bug.cgi?id=1390271",
      "Url": "https://www.mercurial-scm.org/release/windows/mercurial-4.3.3-x86.msi",
      "Name": "Mercurial 4.3.3 (x86)",
      "ProductId": "49831801-1706-46C0-895F-3921F178655B",
      "sha512": "ac082797459e9795ac1b18369d804485aa2cb1eb1f1135f49c89cccb2b2f2634c96bde30cbb2bd0cd4f725e058cc43146142c2dde27eb8eda790fd469e45e4e0"
    },
    {
      "ComponentName": "MercurialConfig",
      "ComponentType": "ChecksumFileDownload",
      "Comment": "Required by clonebundle and share hg extensions",
      "DependsOn": [
        {
          "ComponentType": "MsiInstall",
          "ComponentName": "Mercurial"
        }
      ],
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/Mercurial/mercurial.ini",
      "Target": "C:\\Program Files\\Mercurial\\Mercurial.ini"
    },
    {
      "ComponentName": "robustcheckout",
      "ComponentType": "ChecksumFileDownload",
      "Comment": "Required by robustcheckout hg extension",
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "MozillaBuildSetup"
        }
      ],
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/FirefoxBuildResources/robustcheckout.py",
      "Target": "C:\\mozilla-build\\robustcheckout.py"
    },
    {
      "ComponentName": "MercurialCerts",
      "ComponentType": "ChecksumFileDownload",
      "DependsOn": [
        {
          "ComponentType": "MsiInstall",
          "ComponentName": "Mercurial"
        }
      ],
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/Mercurial/cacert.pem",
      "Target": "C:\\mozilla-build\\msys\\etc\\cacert.pem"
    },
    {
      "ComponentName": "env_MOZILLABUILD",
      "ComponentType": "EnvironmentVariableSet",
      "Comment": "Absolutely required for mozharness builds. Python will fall in a heap, throwing misleading exceptions without this. :)",
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "MozillaBuildSetup"
        }
      ],
      "Name": "MOZILLABUILD",
      "Value": "C:\\mozilla-build",
      "Target": "Machine"
    },
    {
      "ComponentName": "env_PATH",
      "ComponentType": "EnvironmentVariableUniquePrepend",
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "MozillaBuildSetup"
        },
        {
          "ComponentType": "MsiInstall",
          "ComponentName": "Mercurial"
        }
      ],
      "Name": "PATH",
      "Values": [
        "C:\\Program Files\\Mercurial",
        "C:\\mozilla-build\\7zip",
        "C:\\mozilla-build\\info-zip",
        "C:\\mozilla-build\\kdiff3",
        "C:\\mozilla-build\\moztools-x64\\bin",
        "C:\\mozilla-build\\mozmake",
        "C:\\mozilla-build\\msys\\bin",
        "C:\\mozilla-build\\msys\\local\\bin",
        "C:\\mozilla-build\\nsis-3.0b3",
        "C:\\mozilla-build\\nsis-2.46u",
        "C:\\mozilla-build\\python",
        "C:\\mozilla-build\\python\\Scripts",
        "C:\\mozilla-build\\upx391w",
        "C:\\mozilla-build\\wget",
        "C:\\mozilla-build\\yasm"
      ],
      "Target": "Machine"
    },
    {
      "ComponentName": "ToolToolInstall",
      "ComponentType": "FileDownload",
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "MozillaBuildSetup"
        }
      ],
      "Source": "https://raw.githubusercontent.com/mozilla/build-tooltool/master/tooltool.py",
      "Target": "C:\\mozilla-build\\tooltool.py"
    },
    {
      "ComponentName": "reg_WindowsErrorReportingLocalDumps",
      "ComponentType": "RegistryKeySet",
      "Comment": "https://bugzilla.mozilla.org/show_bug.cgi?id=1261812",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting",
      "ValueName": "LocalDumps"
    },
    {
      "ComponentName": "reg_WindowsErrorReportingDontShowUI",
      "ComponentType": "RegistryValueSet",
      "Comment": "https://bugzilla.mozilla.org/show_bug.cgi?id=1261812",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting",
      "ValueName": "DontShowUI",
      "ValueType": "Dword",
      "ValueData": "0x00000001",
      "Hex": true
    },
    {
      "ComponentName": "GenericWorkerDirectory",
      "ComponentType": "DirectoryCreate",
      "Path": "C:\\generic-worker"
    },
    {
      "ComponentName": "GenericWorkerDownload",
      "ComponentType": "ChecksumFileDownload",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "GenericWorkerDirectory"
        }
      ],
      "Source": "https://github.com/taskcluster/generic-worker/releases/download/v10.7.8/generic-worker-windows-386.exe",
      "Target": "C:\\generic-worker\\generic-worker.exe",
      "sha512": "69fad0de6f98c214063830bf64f3aa20b52d9f6906611776ade975c9bc0b4cc9729dee9b2c86952b130987c80e63c50749e1a32158882f0ff34d1167f2c3979a"
    },
    {
      "ComponentName": "LiveLogDownload",
      "ComponentType": "ChecksumFileDownload",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "GenericWorkerDirectory"
        }
      ],
      "Source": "https://github.com/taskcluster/livelog/releases/download/v1.1.0/livelog-windows-386.exe",
      "Target": "C:\\generic-worker\\livelog.exe",
      "sha512": "34cdece120f03e3f6b0ae2576d846c3fc38385fc976a5f20d60a50871e1519fc8a938355a607f6a5a4c658c838089571c435f01731d10600513ea63b3b1be01c"
    },
    {
      "ComponentName": "TaskClusterProxyDownload",
      "ComponentType": "FileDownload",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "GenericWorkerDirectory"
        }
      ],
      "Source": "https://github.com/taskcluster/taskcluster-proxy/releases/download/v4.1.0/taskcluster-proxy-windows-386.exe",
      "Target": "C:\\generic-worker\\taskcluster-proxy.exe",
      "sha512": "367a9f942206c1e74ec7b7f2f0dd09bde55ad37f3e5a62380effcde85bb030dcf85c580bc6d2e21b06df6ad1eefc8322a484e2efdc22566db649d61421f35d66"
    },
    {
      "ComponentName": "LiveLog_Get",
      "ComponentType": "FirewallRule",
      "Protocol": "TCP",
      "LocalPort": 60022,
      "Direction": "Inbound",
      "Action": "Allow"
    },
    {
      "ComponentName": "LiveLog_Put",
      "ComponentType": "FirewallRule",
      "Protocol": "TCP",
      "LocalPort": 60023,
      "Direction": "Inbound",
      "Action": "Allow"
    },
    {
      "ComponentName": "NSSMDownload",
      "ComponentType": "FileDownload",
      "Source": "https://nssm.cc/ci/nssm-2.24-103-gdee49fc.zip",
      "Target": "C:\\Windows\\Temp\\NSSMInstall.zip"
    },
    {
      "ComponentName": "NSSMInstall",
      "ComponentType": "CommandRun",
      "Comment": "NSSM is required to install Generic Worker as a service. Currently ZipInstall fails, so using 7z instead.",
      "Command": "C:\\Program Files\\7-Zip\\7z.exe",
      "Arguments": [
        "x",
        "-oC:\\",
        "C:\\Windows\\Temp\\NSSMInstall.zip"
      ],
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "SevenZip"
        },
        {
          "ComponentType": "FileDownload",
          "ComponentName": "NSSMDownload"
        }
      ],
      "Validate": {
        "PathsExist": [
          "C:\\nssm-2.24-103-gdee49fc\\win32\\nssm.exe"
        ]
      }
    },
    {
      "ComponentName": "GenericWorkerInstall",
      "ComponentType": "CommandRun",
      "Command": "C:\\generic-worker\\generic-worker.exe",
      "Arguments": [
        "install",
        "service",
        "--nssm",
        "C:\\nssm-2.24-103-gdee49fc\\win32\\nssm.exe",
        "--config",
        "C:\\generic-worker\\generic-worker.config"
      ],
      "DependsOn": [
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "GenericWorkerDownload"
        },
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "LiveLogDownload"
        },
        {
          "ComponentType": "FirewallRule",
          "ComponentName": "LiveLog_Get"
        },
        {
          "ComponentType": "FirewallRule",
          "ComponentName": "LiveLog_Put"
        },
        {
          "ComponentType": "CommandRun",
          "ComponentName": "NSSMInstall"
        }
      ],
      "Validate": {
        "PathsExist": [
          "C:\\generic-worker\\run-generic-worker.bat",
          "C:\\generic-worker\\generic-worker.exe"
        ],
        "CommandsReturn": [
          {
            "Command": "C:\\generic-worker\\generic-worker.exe",
            "Arguments": [
              "--version"
            ],
            "Match": "generic-worker 10.7.8"
          }
        ]
      }
    },
    {
      "ComponentName": "DisableDesktopInterrupt",
      "ComponentType": "ChecksumFileDownload",
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "GenericWorkerInstall"
        }
      ],
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/GenericWorker/disable-desktop-interrupt.reg",
      "Target": "C:\\generic-worker\\disable-desktop-interrupt.reg"
    },
    {
      "ComponentName": "GenericWorkerStateWait",
      "ComponentType": "ChecksumFileDownload",
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "GenericWorkerInstall"
        },
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "DisableDesktopInterrupt"
        }
      ],
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/GenericWorker/run-generic-worker-format-and-reboot.bat",
      "Target": "C:\\generic-worker\\run-generic-worker.bat"
    },
    {
      "ComponentName": "TaskUserInitScript",
      "ComponentType": "ChecksumFileDownload",
      "Comment": "https://bugzilla.mozilla.org/show_bug.cgi?id=1433851#c19",
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/GenericWorker/task-user-init-win7.cmd",
      "Target": "C:\\generic-worker\\task-user-init.cmd",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "GenericWorkerDirectory"
        }
      ]
    },
    {
      "ComponentName": "PipConfDirectory",
      "ComponentType": "DirectoryCreate",
      "Comment": "https://pip.pypa.io/en/stable/user_guide/#config-file",
      "Path": "C:\\ProgramData\\pip"
    },
    {
      "ComponentName": "PipConf",
      "ComponentType": "ChecksumFileDownload",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "PipConfDirectory"
        }
      ],
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/pip.conf",
      "Target": "C:\\ProgramData\\pip\\pip.ini"
    },
    {
      "ComponentName": "virtualenv_support",
      "ComponentType": "DirectoryCreate",
      "Path": "C:\\mozilla-build\\python\\Lib\\site-packages\\virtualenv_support",
      "DependsOn": [
        {
          "ComponentType": "ExeInstall",
          "ComponentName": "MozillaBuildSetup"
        }
      ]
    },
    {
      "ComponentName": "virtualenv_support_pywin32",
      "ComponentType": "FileDownload",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "virtualenv_support"
        }
      ],
      "Source": "https://pypi.python.org/packages/cp27/p/pypiwin32/pypiwin32-219-cp27-none-win32.whl#md5=a8b0c1b608c1afeb18cd38d759ee5e29",
      "Target": "C:\\mozilla-build\\python\\Lib\\site-packages\\virtualenv_support\\pypiwin32-219-cp27-none-win32.whl"
    },
    {
      "ComponentName": "virtualenv_support_pywin32_amd64",
      "ComponentType": "FileDownload",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "virtualenv_support"
        }
      ],
      "Source": "https://pypi.python.org/packages/cp27/p/pypiwin32/pypiwin32-219-cp27-none-win_amd64.whl#md5=d7bafcf3cce72c3ce9fdd633a262c335",
      "Target": "C:\\mozilla-build\\python\\Lib\\site-packages\\virtualenv_support\\pypiwin32-219-cp27-none-win_amd64.whl"
    },
    {
      "ComponentName": "HgShared",
      "ComponentType": "DirectoryCreate",
      "Comment": "allows builds to use `hg robustcheckout ...`",
      "Path": "y:\\hg-shared"
    },
    {
      "ComponentName": "HgSharedAccessRights",
      "ComponentType": "CommandRun",
      "Comment": "allows builds to use `hg robustcheckout ...`",
      "Command": "icacls.exe",
      "Arguments": [
        "y:\\hg-shared",
        "/grant",
        "Everyone:(OI)(CI)F"
      ],
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "HgShared"
        }
      ]
    },
    {
      "ComponentName": "PipCache",
      "ComponentType": "DirectoryCreate",
      "Comment": "share pip cache across subsequent task users",
      "Path": "y:\\pip-cache"
    },
    {
      "ComponentName": "PipCacheAccessRights",
      "ComponentType": "CommandRun",
      "Comment": "share pip cache across subsequent task users",
      "Command": "icacls.exe",
      "Arguments": [
        "y:\\pip-cache",
        "/grant",
        "Everyone:(OI)(CI)F"
      ],
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "PipCache"
        }
      ]
    },
    {
      "ComponentName": "env_PIP_DOWNLOAD_CACHE",
      "ComponentType": "EnvironmentVariableSet",
      "Comment": "share pip download cache between tasks",
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "PipCacheAccessRights"
        }
      ],
      "Name": "PIP_DOWNLOAD_CACHE",
      "Value": "y:\\pip-cache",
      "Target": "Machine"
    },
    {
      "ComponentName": "TooltoolCache",
      "ComponentType": "DirectoryCreate",
      "Comment": "share tooltool cache across subsequent task users",
      "Path": "y:\\tooltool-cache"
    },
    {
      "ComponentName": "TooltoolCacheAccessRights",
      "ComponentType": "CommandRun",
      "Comment": "share tooltool cache across subsequent task users",
      "Command": "icacls.exe",
      "Arguments": [
        "y:\\tooltool-cache",
        "/grant",
        "Everyone:(OI)(CI)F"
      ],
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "TooltoolCache"
        }
      ]
    },
    {
      "ComponentName": "env_TOOLTOOL_CACHE",
      "ComponentType": "EnvironmentVariableSet",
      "Comment": "share tooltool cache between tasks",
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "TooltoolCacheAccessRights"
        }
      ],
      "Name": "TOOLTOOL_CACHE",
      "Value": "y:\\tooltool-cache",
      "Target": "Machine"
    },
    {
      "ComponentName": "ngen_executeQueuedItems",
      "ComponentType": "CommandRun",
      "Comment": "https://blogs.msdn.microsoft.com/dotnet/2013/08/06/wondering-why-mscorsvw-exe-has-high-cpu-usage-you-can-speed-it-up",
      "Command": "c:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\ngen.exe",
      "Arguments": [
        "executeQueuedItems"
      ]
    },
    {
      "ComponentName": "CarbonClone",
      "ComponentType": "CommandRun",
      "Comment": "Bug 1316329 - support creation of symlinks by task users",
      "Command": "C:\\Program Files\\Mercurial\\hg.exe",
      "Arguments": [
        "clone",
        "--insecure",
        "https://bitbucket.org/splatteredbits/carbon",
        "C:\\Windows\\Temp\\carbon"
      ],
      "DependsOn": [
        {
          "ComponentType": "MsiInstall",
          "ComponentName": "Mercurial"
        }
      ],
      "Validate": {
        "PathsExist": [
          "C:\\Windows\\Temp\\carbon\\.hg"
        ]
      }
    },
    {
      "ComponentName": "CarbonUpdate",
      "ComponentType": "CommandRun",
      "Comment": "Bug 1316329 - support creation of symlinks by task users",
      "Command": "C:\\Program Files\\Mercurial\\hg.exe",
      "Arguments": [
        "update",
        "2.4.0",
        "-R",
        "C:\\Windows\\Temp\\carbon"
      ],
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "CarbonClone"
        }
      ]
    },
    {
      "ComponentName": "CarbonInstall",
      "ComponentType": "CommandRun",
      "Comment": "Bug 1316329 - support creation of symlinks by task users",
      "Command": "xcopy",
      "Arguments": [
        "C:\\Windows\\Temp\\carbon\\Carbon",
        "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\Modules\\Carbon",
        "/e",
        "/i",
        "/y"
      ],
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "CarbonUpdate"
        }
      ]
    },
    {
      "ComponentName": "GrantEveryoneSeCreateSymbolicLinkPrivilege",
      "ComponentType": "CommandRun",
      "Comment": "Bug 1316329 - support creation of symlinks by task users",
      "Command": "powershell",
      "Arguments": [
        "-command",
        "\"& {&'Import-Module' Carbon}\";",
        "\"& {&'Grant-Privilege' -Identity Everyone -Privilege SeCreateSymbolicLinkPrivilege}\""
      ],
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "CarbonInstall"
        }
      ]
    },
    {
      "ComponentName": "MozillaMaintenanceDir",
      "ComponentType": "DirectoryCreate",
      "Comment": "Working directory for Mozilla Maintenance Service installation",
      "Path": "C:\\dsc\\MozillaMaintenance"
    },
    {
      "ComponentName": "maintenanceservice_installer",
      "ComponentType": "ChecksumFileDownload",
      "Source": "https://github.com/mozilla-releng/OpenCloudConfig/blob/master/userdata/Configuration/Mozilla%20Maintenance%20Service/maintenanceservice_installer.exe?raw=true",
      "Target": "C:\\dsc\\MozillaMaintenance\\maintenanceservice_installer.exe",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "MozillaMaintenanceDir"
        }
      ],
      "sha512": "4c200d59db17afcaa4deec9f083a75362b8baf0974483cb573b37587d605315513590c076f263f0a5e9165695751a076a839579e169a24507daf4cbc2b30d85e"
    },
    {
      "ComponentName": "maintenanceservice",
      "ComponentType": "ChecksumFileDownload",
      "Source": "https://github.com/mozilla-releng/OpenCloudConfig/blob/master/userdata/Configuration/Mozilla%20Maintenance%20Service/maintenanceservice.exe?raw=true",
      "Target": "C:\\dsc\\MozillaMaintenance\\maintenanceservice.exe",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "MozillaMaintenanceDir"
        }
      ],
      "sha512": "8ef24f6abeb4a0929c0a112788fd55881d6abdc3474bd825e905981e4993ec345d1afd6636f07aa55275a24463c5fbf85d00d35446703dd4d73c92e28415ca5f"
    },
    {
      "ComponentName": "maintenanceservice_install",
      "ComponentType": "CommandRun",
      "Command": "C:\\dsc\\MozillaMaintenance\\maintenanceservice_installer.exe",
      "Arguments": [
        "/s"
      ],
      "DependsOn": [
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "maintenanceservice_installer"
        },
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "maintenanceservice"
        }
      ],
      "Validate": {
        "PathsExist": [
          "C:\\Program Files\\Mozilla Maintenance Service\\maintenanceservice.exe",
          "C:\\Program Files\\Mozilla Maintenance Service\\Uninstall.exe"
        ]
      }
    },
    {
      "ComponentName": "MaintenanceServiceAcessRights",
      "ComponentType": "CommandRun",
      "Comment": "See https://bugzilla.mozilla.org/show_bug.cgi?id=1067756#c21",
      "Command": "icacls.exe",
      "Arguments": [
        "\"C:\\Program Files\\Mozilla Maintenance Service\"",
        "/grant",
        "Everyone:(OI)(CI)F"
      ],
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "maintenanceservice_install"
        }
      ]
    },
    {
      "ComponentName": "MozFakeCA_cer",
      "ComponentType": "ChecksumFileDownload",
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/Mozilla%20Maintenance%20Service/MozFakeCA.cer",
      "Target": "C:\\dsc\\MozillaMaintenance\\MozFakeCA.cer",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "MozillaMaintenanceDir"
        }
      ]
    },
    {
      "ComponentName": "MozFakeCA_cer",
      "ComponentType": "CommandRun",
      "Command": "certutil.exe",
      "Arguments": [
        "-addstore",
        "Root",
        "C:\\dsc\\MozillaMaintenance\\MozFakeCA.cer"
      ],
      "DependsOn": [
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "MozFakeCA_cer"
        }
      ]
    },
    {
      "ComponentName": "MozFakeCA_2017_10_13_cer",
      "ComponentType": "ChecksumFileDownload",
      "Source": "https://raw.githubusercontent.com/mozilla-releng/OpenCloudConfig/master/userdata/Configuration/Mozilla%20Maintenance%20Service/MozFakeCA_2017-10-13.cer",
      "Target": "C:\\dsc\\MozillaMaintenance\\MozFakeCA_2017-10-13.cer",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "MozillaMaintenanceDir"
        }
      ]
    },
    {
      "ComponentName": "MozFakeCA_2017_10_13_cer",
      "ComponentType": "CommandRun",
      "Command": "certutil.exe",
      "Arguments": [
        "-addstore",
        "Root",
        "C:\\dsc\\MozillaMaintenance\\MozFakeCA_2017-10-13.cer"
      ],
      "DependsOn": [
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "MozFakeCA_2017_10_13_cer"
        }
      ]
    },
    {
      "ComponentName": "MozRoot_cer",
      "ComponentType": "ChecksumFileDownload",
      "Source": "https://s3.amazonaws.com/windows-opencloudconfig-packages/certs/MozRoot.cer",
      "Target": "C:\\dsc\\MozillaMaintenance\\MozRoot.cer",
      "DependsOn": [
        {
          "ComponentType": "DirectoryCreate",
          "ComponentName": "MozillaMaintenanceDir"
        }
      ]
    },
    {
      "ComponentName": "MozRoot_cer",
      "ComponentType": "CommandRun",
      "Command": "certutil.exe",
      "Arguments": [
        "-addstore",
        "Root",
        "C:\\dsc\\MozillaMaintenance\\MozRoot.cer"
      ],
      "DependsOn": [
        {
          "ComponentType": "ChecksumFileDownload",
          "ComponentName": "MozRoot_cer"
        }
      ]
    },
    {
      "ComponentName": "reg_Mozilla_MaintenanceService_3932ecacee736d366d6436db0f55bce4_0_name",
      "ComponentType": "RegistryValueSet",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\MaintenanceService\\3932ecacee736d366d6436db0f55bce4\\0",
      "ValueName": "name",
      "ValueType": "String",
      "ValueData": "Mozilla Corporation"
    },
    {
      "ComponentName": "reg_Mozilla_MaintenanceService_3932ecacee736d366d6436db0f55bce4_0_issuer",
      "ComponentType": "RegistryValueSet",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\MaintenanceService\\3932ecacee736d366d6436db0f55bce4\\0",
      "ValueName": "issuer",
      "ValueType": "String",
      "ValueData": "Thawte Code Signing CA - G2"
    },
    {
      "ComponentName": "reg_Mozilla_MaintenanceService_3932ecacee736d366d6436db0f55bce4_0_programName",
      "ComponentType": "RegistryValueSet",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\MaintenanceService\\3932ecacee736d366d6436db0f55bce4\\0",
      "ValueName": "programName",
      "ValueType": "String",
      "ValueData": ""
    },
    {
      "ComponentName": "reg_Mozilla_MaintenanceService_3932ecacee736d366d6436db0f55bce4_0_publisherLink",
      "ComponentType": "RegistryValueSet",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\MaintenanceService\\3932ecacee736d366d6436db0f55bce4\\0",
      "ValueName": "publisherLink",
      "ValueType": "String",
      "ValueData": ""
    },
    {
      "ComponentName": "reg_Mozilla_MaintenanceService_3932ecacee736d366d6436db0f55bce4_1_name",
      "ComponentType": "RegistryValueSet",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\MaintenanceService\\3932ecacee736d366d6436db0f55bce4\\1",
      "ValueName": "name",
      "ValueType": "String",
      "ValueData": "Mozilla Fake SPC"
    },
    {
      "ComponentName": "reg_Mozilla_MaintenanceService_3932ecacee736d366d6436db0f55bce4_1_issuer",
      "ComponentType": "RegistryValueSet",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\MaintenanceService\\3932ecacee736d366d6436db0f55bce4\\1",
      "ValueName": "issuer",
      "ValueType": "String",
      "ValueData": "Mozilla Fake CA"
    },
    {
      "ComponentName": "reg_Mozilla_MaintenanceService_3932ecacee736d366d6436db0f55bce4_1_programName",
      "ComponentType": "RegistryValueSet",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\MaintenanceService\\3932ecacee736d366d6436db0f55bce4\\1",
      "ValueName": "programName",
      "ValueType": "String",
      "ValueData": ""
    },
    {
      "ComponentName": "reg_Mozilla_MaintenanceService_3932ecacee736d366d6436db0f55bce4_1_publisherLink",
      "ComponentType": "RegistryValueSet",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\MaintenanceService\\3932ecacee736d366d6436db0f55bce4\\1",
      "ValueName": "publisherLink",
      "ValueType": "String",
      "ValueData": ""
    },
    {
      "ComponentName": "reg_Mozilla_MaintenanceService_3932ecacee736d366d6436db0f55bce4_2_name",
      "ComponentType": "RegistryValueSet",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\MaintenanceService\\3932ecacee736d366d6436db0f55bce4\\2",
      "ValueName": "name",
      "ValueType": "String",
      "ValueData": "Mozilla Corporation"
    },
    {
      "ComponentName": "reg_Mozilla_MaintenanceService_3932ecacee736d366d6436db0f55bce4_2_issuer",
      "ComponentType": "RegistryValueSet",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\MaintenanceService\\3932ecacee736d366d6436db0f55bce4\\2",
      "ValueName": "issuer",
      "ValueType": "String",
      "ValueData": "DigiCert SHA2 Assured ID Code Signing CA"
    },
    {
      "ComponentName": "reg_Mozilla_MaintenanceService_3932ecacee736d366d6436db0f55bce4_2_programName",
      "ComponentType": "RegistryValueSet",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\MaintenanceService\\3932ecacee736d366d6436db0f55bce4\\2",
      "ValueName": "programName",
      "ValueType": "String",
      "ValueData": ""
    },
    {
      "ComponentName": "reg_Mozilla_MaintenanceService_3932ecacee736d366d6436db0f55bce4_2_publisherLink",
      "ComponentType": "RegistryValueSet",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Mozilla\\MaintenanceService\\3932ecacee736d366d6436db0f55bce4\\2",
      "ValueName": "publisherLink",
      "ValueType": "String",
      "ValueData": ""
    },
    {
      "ComponentName": "GrantEveryoneMozillaRegistryWriteAccess",
      "ComponentType": "CommandRun",
      "Comment": "Bug 1353889 - Grant all users account write access to Mozilla registry key",
      "Command": "powershell",
      "Arguments": [
        "-command",
        "\"& {& (Get-Acl -Path 'HKLM:\\SOFTWARE\\Mozilla').SetAccessRule(New-Object System.Security.AccessControl.RegistryAccessRule ('Everyone', 'FullControl', 'Allow'))}\";",
        "\"& {& ((Get-Acl -Path 'HKLM:\\SOFTWARE\\Mozilla') | Set-Acl -Path 'HKLM:\\SOFTWARE\\Mozilla')}\""
      ],
      "DependsOn": [
        {
          "ComponentType": "CommandRun",
          "ComponentName": "CarbonInstall"
        }
      ]
    },
    {
      "ComponentName": "KmsIn",
      "ComponentType": "FirewallRule",
      "Protocol": "TCP",
      "LocalPort": 1688,
      "Direction": "Inbound",
      "Action": "Allow"
    },
    {
      "ComponentName": "KmsOut",
      "ComponentType": "FirewallRule",
      "Protocol": "TCP",
      "LocalPort": 1688,
      "Direction": "Outbound",
      "Action": "Allow"
    },
    {
      "ComponentName": "nircmd",
      "ComponentType": "FileDownload",
      "Source": "https://s3.amazonaws.com/windows-opencloudconfig-packages/nircmd/nircmd.exe",
      "Target": "C:\\Windows\\System32\\nircmd.exe"
    },
    {
      "ComponentName": "nircmdc",
      "ComponentType": "FileDownload",
      "Source": "https://s3.amazonaws.com/windows-opencloudconfig-packages/nircmd/nircmdc.exe",
      "Target": "C:\\Windows\\System32\\nircmdc.exe"
    },
    {
      "ComponentName": "reg_Power_PreferredPlan_HighPerformance",
      "ComponentType": "RegistryValueSet",
      "Comment": "https://bugzilla.mozilla.org/show_bug.cgi?id=1362613",
      "Key": "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\explorer\\ControlPanel\\NameSpace\\{025A5937-A6BE-4686-A844-36FE4BEC8B6D}",
      "ValueName": "PreferredPlan",
      "ValueType": "String",
      "ValueData": "8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c"
    },
    {
      "ComponentName": "DisableWinDefend",
      "ComponentType": "ServiceControl",
      "Comment": "https://bugzilla.mozilla.org/show_bug.cgi?id=1365909",
      "Name": "WinDefend",
      "StartupType": "Disabled",
      "State": "Stopped"
    },
    {
      "ComponentName": "DisableWinDefend",
      "ComponentType": "ServiceControl",
      "Comment": "https://bugzilla.mozilla.org/show_bug.cgi?id=1365909",
      "Name": "WinDefend",
      "StartupType": "Disabled",
      "State": "Stopped"
    }
  ]
}
